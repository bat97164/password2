#!/usr/bin/env ruby

require File.expand_path('../../config/environment', __FILE__)

# Check if email argument is provided
if ARGV.empty?
  puts "Usage: #{$0} <email_address>"
  exit 1
end

email = ARGV[0]

begin
  user = User.find_by!(email: email)

  if user.update(admin: false)
    puts "\nUser successfully demoted!"
    puts "========================"
    puts "Email: #{email}"
    puts "Admin access has been removed."
  else
    puts "\nError updating user:"
    puts user.errors.full_messages.join("\n")
    exit 1
  end

rescue ActiveRecord::RecordNotFound
  puts "\nError: No user found with email '#{email}'"
  exit 1
rescue StandardError => e
  puts "\nAn error occurred:"
  puts e.message
  exit 1
end
